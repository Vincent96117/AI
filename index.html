<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>üî± TRIDENT V17.5 - FINAL STRIKE</title>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; padding: 20px; }
        .card { border: 1px solid #333; padding: 15px; margin-bottom: 15px; background: #050505; border-radius: 8px; }
        .symbol { font-size: 1.8rem; color: #00ffcc; font-weight: bold; }
        .ai-box { background: #111; padding: 12px; color: #fff; border-left: 4px solid #0f0; margin-top: 10px; white-space: pre-wrap; min-height: 80px; }
    </style>
</head>
<body>
    <h2>üî± TRIDENT V17.5 <span style="color:#4285F4">Gemini Direct</span></h2>
    <div id="deck"></div>

    <script>
        const GK = "AIzaSyCK5cMo5FL895WwRzggkFjPi0JRe5tVqXQ";
        const PU = "Gkhqyhobnxzjfwgvaiyp347m1jkhn4";
        const PT = "acyoe3sz15x4n91r1349fdcau7x6pw";
        const BLACKLIST = ["BTCUSDT", "ETHUSDT", "SOLUSDT", "XRPUSDT", "BNBUSDT", "BNXUSDT"];

        let market = {};
        let busy = false;

        async function init() {
            const r = await fetch("https://fapi.binance.com/fapi/v1/premiumIndex");
            const d = await r.json();
            d.forEach(i => {
                if (i.symbol.endsWith("USDT") && !BLACKLIST.includes(i.symbol)) {
                    market[i.symbol] = { s: i.symbol, fd: parseFloat(i.lastFundingRate)*100, p: i.markPrice };
                }
            });
            const ws = new WebSocket("wss://fstream.binance.com/ws/!ticker@arr");
            ws.onmessage = (e) => {
                JSON.parse(e.data).forEach(t => { if(market[t.s]) market[t.s].p = t.c; });
                draw();
            };
        }

        function draw() {
            const list = Object.values(market).filter(x => x.p).sort((a,b) => Math.abs(b.fd) - Math.abs(a.fd)).slice(0,3);
            const deck = document.getElementById("deck");
            deck.innerHTML = "";
            list.forEach(item => {
                const isH = Math.abs(item.fd) >= 0.05;
                const div = document.createElement("div");
                div.className = "card";
                div.innerHTML = `<span class="symbol">${item.s}</span> [FD: ${item.fd.toFixed(4)}%] <div id="ai-${item.s}" class="ai-box">Á≥ªÁµ±ÊéÉÊèè‰∏≠...</div>`;
                deck.appendChild(div);
                if (isH && !busy) callGemini(item);
            });
        }

        async function callGemini(item) {
            busy = true;
            const box = document.getElementById(`ai-${item.s}`);
            box.innerText = ">> AI Ê≠£Âú®Âº∑Ë°åÁ™ÅÁ†¥ÈÄ£Á∑ö...";

            try {
                // Áõ¥Êé•ÂØ´Ê≠ªÊï¥‰∏≤Á∂≤ÂùÄÔºå‰∏ÄÂ≠ó‰∏çÂ∑ÆÔºÅËß£Ê±∫ 404 ÂïèÈ°å
                const target = "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=" + GK;

                const response = await fetch(target, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `‰Ω†ÊòØÂ∞àÊ•≠‰∫§ÊòìÂì°„ÄÇÊ®ôÁöÑ:${item.s},Ë≥áË≤ª:${item.fd.toFixed(4)}%,ÂÉπÊ†º:${item.p}„ÄÇË´ãÁµ¶Âá∫:1.ÊñπÂêë(Â§ö/Á©∫) 2.Â§ö‰πÖË°®ÊÖã(min) 3.ÂãùÁéá„ÄÇÁπÅÈ´î‰∏≠ÊñáÔºåÁµêË´ñÁ¨¨‰∏ÄË°å„ÄÇ` }] }]
                    })
                });

                const data = await response.json();
                if (data.error) throw new Error(data.error.message);

                const res = data.candidates[0].content.parts[0].text;
                box.innerText = ">> " + res;

                if (res.includes("9") || res.includes("È´ò")) {
                    fetch("https://api.pushover.net/1/messages.json", {
                        method: "POST",
                        headers: { "Content-Type": "application/x-www-form-urlencoded" },
                        body: `token=${PT}&user=${PU}&message=${encodeURIComponent(res)}&title=üî±ÁãôÊìä:${item.s}`
                    });
                }
            } catch (err) { 
                box.innerText = "‚ùå Ë≠¶Âëä: " + err.message; 
            }
            finally { setTimeout(() => { busy = false; }, 10000); }
        }
        init();
    </script>
</body>
</html>
