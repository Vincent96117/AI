<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ðŸ”± TRIDENT V20.0 - LEVEL 3</title>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; padding: 20px; }
        .card { border: 2px solid #333; padding: 15px; margin-bottom: 15px; background: #050505; border-radius: 10px; border-top: 5px solid #555; }
        .symbol { font-size: 2rem; color: #00ffcc; font-weight: bold; }
        .stats { color: #888; font-size: 0.9rem; margin: 10px 0; }
        .ai-box { background: #111; padding: 15px; color: #fff; border-left: 5px solid #f0f; margin-top: 10px; font-size: 1.1rem; line-height: 1.6; }
        .alert { border-color: #f0f !important; }
    </style>
</head>
<body>
    <h2>ðŸ”± TRIDENT V20.0 | <span style="color:#f0f">LEVEL 3 è¨ºæ–·å¼•æ“Ž</span></h2>
    <div id="deck"></div>

    <script>
        // è«‹åœ¨æ­¤å¡«å…¥ä½ çš„ ChatGPT Key
        const OPENAI_KEY = "ä½ çš„_OPENAI_API_KEY"; 
        const PUSHOVER = { u: "Gkhqyhobnxzjfwgvaiyp347m1jkhn4", t: "acyoe3sz15x4n91r1349fdcau7x6pw" };
        const BLACKLIST = ["BTCUSDT", "ETHUSDT", "SOLUSDT", "XRPUSDT", "BNBUSDT", "BNXUSDT"];

        let market = {};
        let busy = false;

        async function init() {
            // æŠ“å–è³‡è²»èˆ‡æŒå€‰æ•¸æ“š (OI)
            const [f_res, o_res] = await Promise.all([
                fetch("https://fapi.binance.com/fapi/v1/premiumIndex"),
                fetch("https://fapi.binance.com/fapi/v1/ticker/24hr")
            ]);
            const f_data = await f_res.json();
            
            f_data.forEach(i => {
                if (i.symbol.endsWith("USDT") && !BLACKLIST.includes(i.symbol)) {
                    market[i.symbol] = { 
                        s: i.symbol, 
                        fd: parseFloat(i.lastFundingRate)*100, 
                        p: parseFloat(i.markPrice),
                        startP: parseFloat(i.markPrice),
                        histP: []
                    };
                }
            });
            
            // é–‹å•Ÿ WebSocket
            const ws = new WebSocket("wss://fstream.binance.com/ws/!ticker@arr");
            ws.onmessage = (e) => {
                JSON.parse(e.data).forEach(t => {
                    if (market[t.s]) {
                        market[t.s].p = parseFloat(t.c);
                        market[t.s].histP.push(t.c);
                        if(market[t.s].histP.length > 10) market[t.s].histP.shift();
                    }
                });
                draw();
            };
        }

        function draw() {
            const list = Object.values(market).filter(x => x.p).sort((a,b) => Math.abs(b.fd) - Math.abs(a.fd)).slice(0,3);
            const deck = document.getElementById("deck");
            deck.innerHTML = "";
            list.forEach(item => {
                const isAlert = Math.abs(item.fd) >= 0.05;
                const div = document.createElement("div");
                div.className = `card ${isAlert?'alert':''}`;
                div.innerHTML = `
                    <div style="display:flex; justify-content:space-between;">
                        <span class="symbol">${item.s}</span>
                        <span style="color:${item.fd>=0?'#0f0':'#f00'}">è³‡è²»: ${item.fd.toFixed(4)}%</span>
                    </div>
                    <div class="stats">åƒ¹æ ¼è®Šå‹•: ${item.startP} â†’ ${item.p} (${(((item.p-item.startP)/item.startP)*100).toFixed(2)}%)</div>
                    <div id="ai-${item.s}" class="ai-box">LEVEL 3 ç›£æŽ§ä¸­...</div>
                `;
                deck.appendChild(div);
                if (isAlert && !busy) callLevel3(item);
            });
        }

        async function callLevel3(item) {
            busy = true;
            const box = document.getElementById(`ai-${item.s}`);
            box.innerText = ">> [LEVEL 3] æ­£åœ¨äº¤å‰åˆ†æžåƒ¹æ ¼èˆ‡æŒå€‰æ„åœ–...";

            try {
                const response = await fetch("https://api.openai.com/v1/chat/completions", {
                    method: "POST",
                    headers: { "Authorization": `Bearer ${OPENAI_KEY}`, "Content-Type": "application/json" },
                    body: JSON.stringify({
                        model: "gpt-4o-mini",
                        messages: [{
                            role: "user",
                            content: `ä½ ç¾åœ¨æ˜¯ Trident LEVEL 3 äº¤æ˜“å¼•æ“Žã€‚
                            æ¨™çš„: ${item.s}
                            è³‡è²»: ${item.fd.toFixed(4)}%
                            åƒ¹æ ¼åºåˆ—: ${item.histP.join('->')}
                            
                            è«‹åŸ·è¡Œè¨ºæ–·ï¼š
                            1. æ–¹å‘(å¤š/ç©º)èˆ‡å‹çŽ‡
                            2. é è¨ˆè¡¨æ…‹æ™‚é–“(min)
                            3. è³‡é‡‘æµå‘(æ˜¯ä¸»åŠ›å»ºå€‰é‚„æ˜¯æ•£æˆ¶è¸©è¸ï¼Ÿ)
                            ç¹é«”ä¸­æ–‡ï¼Œçµè«–ç¬¬ä¸€è¡Œæ ¼å¼ï¼šã€æ–¹å‘/æ™‚é–“ã€‘æ¨™çš„ - å‹çŽ‡ã€‚`
                        }]
                    })
                });

                const data = await response.json();
                const res = data.choices[0].message.content;
                box.innerText = ">> " + res;

                // Pushover [cite: 2026-01-21]
                const title = res.split('\n')[0];
                sendPushover(res, title);

            } catch (err) { box.innerText = "âŒ éŒ¯èª¤: " + err.message; }
            finally { setTimeout(() => { busy = false; }, 15000); }
        }

        function sendPushover(m, t) {
            fetch("https://api.pushover.net/1/messages.json", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: `token=${PUSHOVER.t}&user=${PUSHOVER.u}&message=${encodeURIComponent(m)}&title=${encodeURIComponent(t)}`
            });
        }
        init();
    </script>
</body>
</html>
