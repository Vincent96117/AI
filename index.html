<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ğŸ”± TRIDENT V12.0 - HYPER-STRIKE</title>
    <style>
        :root { --bg: #050505; --card: #0d0d0d; --accent: #00ffcc; --text: #f0f0f0; --purple: #d400ff; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; padding: 10px; margin: 0; }
        .header { background: #111; padding: 15px; border-radius: 12px; text-align: center; border: 1px solid #333; margin-bottom: 10px; }
        #sniper-deck { display: grid; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); gap: 15px; }
        .card { background: var(--card); border: 1px solid #222; border-radius: 15px; padding: 18px; border-top: 3px solid #333; }
        .symbol { font-size: 1.8rem; font-weight: 900; color: var(--accent); }
        .funding { font-family: monospace; font-size: 0.8rem; padding: 4px 8px; border-radius: 5px; border: 1px solid #333; }
        .alert-purple { background: var(--purple) !important; color: white !important; box-shadow: 0 0 15px var(--purple); border: none; }
        .ai-box { background: #000; color: var(--accent); padding: 12px; border-radius: 10px; font-size: 0.85rem; border-left: 4px solid var(--accent); min-height: 120px; border: 1px solid #222; white-space: pre-wrap; }
    </style>
</head>
<body>
    <div class="header"><h1>ğŸ”± TRIDENT <span style="color:var(--accent)">V12.0 STRIKE</span></h1></div>
    <div id="sniper-deck"></div>

    <script>
        const PUSHOVER_USER = "Gkhqyhobnxzjfwgvaiyp347m1jkhn4";
        const PUSHOVER_TOKEN = "acyoe3sz15x4n91r1349fdcau7x6pw";
        const GROQ_KEY = "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";
        const BLACKLIST = ["BTCUSDT", "ETHUSDT", "SOLUSDT", "XRPUSDT", "BNBUSDT", "BNXUSDT"];
        
        let market = {};
        let isAiBusy = false;
        let lastAiTime = {};

        async function init() {
            const resp = await fetch("https://fapi.binance.com/fapi/v1/premiumIndex");
            const data = await resp.json();
            data.forEach(i => {
                if (i.symbol.endsWith("USDT") && !BLACKLIST.includes(i.symbol)) {
                    market[i.symbol] = { s: i.symbol, fd: parseFloat(i.lastFundingRate) * 100, price: i.markPrice, hist: [] };
                }
            });
            startWSS();
        }

        function startWSS() {
            const ws = new WebSocket("wss://fstream.binance.com/ws/!ticker@arr");
            ws.onmessage = (e) => {
                JSON.parse(e.data).forEach(t => {
                    if (market[t.s]) {
                        market[t.s].price = t.c;
                        market[t.s].change = t.P;
                        market[t.s].hist.push(parseFloat(t.c).toFixed(4));
                        if(market[t.s].hist.length > 20) market[t.s].hist.shift();
                    }
                });
                render();
            };
        }

        function render() {
            const top = Object.values(market).filter(i => i.price).sort((a, b) => Math.abs(b.fd) - Math.abs(a.fd)).slice(0, 3);
            const deck = document.getElementById('sniper-deck');
            deck.innerHTML = "";

            top.forEach(item => {
                const isAlert = Math.abs(item.fd) >= 0.05;
                const card = document.createElement('div');
                card.className = 'card';
                if(isAlert) card.style.borderColor = 'var(--purple)';
                card.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span class="symbol">${item.s}</span>
                        <span class="funding ${isAlert ? 'alert-purple' : ''}">FD: ${item.fd.toFixed(4)}%</span>
                    </div>
                    <div style="margin:10px 0; font-size:0.9rem;">ç¾åƒ¹: ${item.price} | 24H: ${item.change}%</div>
                    <div class="ai-box" id="ai-${item.s}">>> ç³»çµ±å¾…å‘½ï¼Œç¬¦åˆé–€æª»å³è‡ªå‹•åˆ†æ...</div>
                `;
                deck.appendChild(card);

                const slope = item.hist.length > 10 ? ((item.hist[item.hist.length-1] - item.hist[0]) / item.hist[0] * 100) : 0;
                // æ¢ä»¶è§¸ç™¼ [cite: 2026-01-11]
                if ((isAlert || Math.abs(slope) > 0.1) && !isAiBusy && (!lastAiTime[item.s] || Date.now() - lastAiTime[item.s] > 60000)) {
                    runHyperStrikeAI(item);
                }
            });
        }

        async function runHyperStrikeAI(item) {
            isAiBusy = true;
            lastAiTime[item.s] = Date.now();
            const box = document.getElementById(`ai-${item.s}`);
            box.innerText = ">> [å®šå‘ç‹™æ“Šä¸­] æ­£åœ¨åˆ¤æ–·å¤šç©ºã€è¡¨æ…‹æ™‚é–“èˆ‡å‹ç‡...";

            try {
                const oiRes = await fetch(`https://fapi.binance.com/fapi/v1/openInterest?symbol=${item.s}`).then(r => r.json());
                const oiVal = (parseFloat(oiRes.openInterest) / 1000000).toFixed(1) + "M";

                // å¼·åˆ¶ POST å°è£ï¼Œå¾¹åº•è§£æ±º 400 éŒ¯èª¤
                const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                    method: "POST",
                    headers: { 
                        "Authorization": "Bearer " + GROQ_KEY,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        model: "llama3-70b-8192",
                        messages: [{ 
                            role: "user", 
                            content: `è·æ¥­ç‹™æ“Šã€‚æ¨™çš„:${item.s}, èµ°å‹¢:${item.hist.join("->")}, OI:${oiVal}, è³‡è²»:${item.fd.toFixed(4)}%ã€‚è«‹å›å ±ï¼š1.æ˜ç¢ºæ–¹å‘(å¤š/ç©º) 2.å¤šä¹…å…§è¡¨æ…‹(min) 3.å‹ç‡% 4.ä¸»åŠ›æ„åœ–ã€‚ç¹ä¸­ï¼Œçµè«–æ”¾ç¬¬ä¸€è¡Œã€‚` 
                        }],
                        temperature: 0.1
                    })
                });

                const data = await response.json();
                const result = data.choices[0].message.content;
                box.innerText = ">> " + result;

                // Pushover é‚è¼¯å„ªåŒ–ï¼šæ¨™é¡Œç›´æ¥çµ¦ç­”æ¡ˆ [cite: 2026-01-21]
                if (result.includes("9") || result.includes("é«˜å‹ç‡")) {
                    const dir = result.includes("å¤š") ? "å¤š" : (result.includes("ç©º") ? "ç©º" : "ï¼Ÿ");
                    const timeMatch = result.match(/(\d+)\s*(min|åˆ†)/);
                    const timeStr = timeMatch ? timeMatch[1] + "m" : "å³å°‡";
                    const winMatch = result.match(/(\d+%)/);
                    const winStr = winMatch ? winMatch[1] : "90%+";
                    
                    sendPushover(result, `ã€${dir}/${timeStr}ã€‘${item.s} - ${winStr}`);
                }
            } catch (err) {
                box.innerText = "âŒ è«‹æ±‚å¤±æ•—ï¼Œè«‹ç¢ºèªæ©˜è‰²å¤–æ›ç‚º ONã€‚";
            } finally {
                setTimeout(() => { isAiBusy = false; }, 8000);
            }
        }

        function sendPushover(msg, title) {
            fetch("https://api.pushover.net/1/messages.json", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: `token=${PUSHOVER_TOKEN}&user=${PUSHOVER_USER}&message=${encodeURIComponent(msg)}&title=${encodeURIComponent(title)}`
            });
        }
        init();
    </script>
</body>
</html>
