<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>TRIDENT V6.5 - ALL-IN-ONE SNIPER</title>
    <style>
        :root { --bg: #050505; --card: #111; --accent: #00ffcc; --text: #f0f0f0; --purple: #d400ff; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; padding: 20px; }
        .monitor-panel { background: #1a1a1a; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #333; text-align: center; }
        #top-3-deck { display: grid; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); gap: 20px; }
        .sniper-card { background: var(--card); border: 2px solid #333; border-radius: 15px; padding: 25px; transition: 0.4s; }
        .sniper-card.highlight { border-color: var(--accent); box-shadow: 0 0 15px rgba(0,255,204,0.2); }
        .symbol-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .symbol-name { font-size: 2rem; font-weight: 900; color: var(--accent); }
        .funding-tag { font-size: 0.8rem; padding: 2px 8px; border-radius: 4px; border: 1px solid #444; }
        .funding-alert { color: white; background: var(--purple); border-color: var(--purple); font-weight: bold; }
        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .data-item { background: #000; padding: 10px; border-radius: 8px; text-align: center; font-size: 0.9rem; }
        .ai-terminal { background: #080808; color: var(--accent); padding: 15px; border-radius: 10px; font-size: 0.9rem; line-height: 1.6; border: 1px solid #222; min-height: 80px; }
        .scan-loader { font-size: 0.8rem; color: #666; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="monitor-panel">
        <h1 style="margin:0; color:var(--accent);">ğŸ”± TRIDENT V6.5 <span style="color:#fff">çµ‚æ¥µç‹™æ“Šé¡</span></h1>
        <div id="status" class="scan-loader">æ­£åœ¨åˆå§‹åŒ–å…¨å¸‚å ´æ•¸æ“š...</div>
    </div>

    <div id="top-3-deck"></div>

    <script>
        const GROQ_KEY = "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";
        const BLACKLIST = ["BTCUSDT", "ETHUSDT", "SOLUSDT", "XRPUSDT", "BNBUSDT", "BNXUSDT"];
        let marketData = [];

        async function engine() {
            try {
                const resp = await fetch('https://fapi.binance.com/fapi/v1/exchangeInfo');
                const info = await resp.json();
                const list = info.symbols
                    .filter(s => s.quoteAsset === "USDT" && s.status === "TRADING" && !BLACKLIST.includes(s.symbol))
                    .map(s => s.symbol);

                // æ‰¹æ¬¡æƒæå…¨å¸‚å ´ (Batch 15)
                for (let i = 0; i < list.length; i += 15) {
                    const batch = list.slice(i, i + 15);
                    document.getElementById('status').innerText = `å…¨å¸‚å ´æƒæä¸­: ${i}/${list.length} (å·²éæ¿¾ä¸»æµå¹£)`;
                    await Promise.all(batch.map(s => scan(s)));
                    renderTop3();
                    await new Promise(r => setTimeout(r, 400)); // é¿å… API å°é–
                }
                document.getElementById('status').innerText = `æƒæé€±æœŸå®Œæˆï¼Œç­‰å¾…åˆ·æ–°...`;
                setTimeout(engine, 20000);
            } catch (e) { console.error(e); }
        }

        async function scan(s) {
            try {
                const [pIndex, oiData, klines] = await Promise.all([
                    fetch(`https://fapi.binance.com/fapi/v1/premiumIndex?symbol=${s}`).then(r => r.json()),
                    fetch(`https://fapi.binance.com/fapi/v1/openInterestHist?symbol=${s}&period=5m&limit=12`).then(r => r.json()),
                    fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=5m&limit=20`).then(r => r.json())
                ]);

                const oiChg = ((oiData[11].sumOpenInterest - oiData[0].sumOpenInterest) / oiData[0].sumOpenInterest * 100);
                const volRatio = parseFloat(klines[19][5]) / (klines.reduce((a, b) => a + parseFloat(b[5]), 0) / 20);
                const funding = parseFloat(pIndex.lastFundingRate) * 100;
                
                // è©•åˆ†ï¼šOI æ¼² + é‡ç¸®æ­» (VolRatio è¶Šä½åˆ†è¶Šé«˜)
                const score = oiChg + (1 - volRatio) * 10; 
                
                const entry = { s, oiChg, volRatio, funding, price: pIndex.markPrice, score, klines };
                const idx = marketData.findIndex(m => m.s === s);
                if(idx > -1) marketData[idx] = entry; else marketData.push(entry);
            } catch (e) {}
        }

        function renderTop3() {
            const top3 = [...marketData].sort((a, b) => b.score - a.score).slice(0, 3);
            const deck = document.getElementById('top-3-deck');
            deck.innerHTML = "";

            top3.forEach(item => {
                const isFundingAlert = Math.abs(item.funding) >= 0.05;
                const card = document.createElement('div');
                card.className = 'sniper-card highlight';
                card.innerHTML = `
                    <div class="symbol-row">
                        <span class="symbol-name">${item.s}</span>
                        <span class="funding-tag ${isFundingAlert ? 'funding-alert' : ''}">è³‡è²»: ${item.funding.toFixed(4)}%</span>
                    </div>
                    <div class="data-grid">
                        <div class="data-item"><div>OI è®ŠåŒ–(1H)</div><div style="color:var(--accent)">+${item.oiChg.toFixed(2)}%</div></div>
                        <div class="data-item"><div>é‡ç¸®ç¨‹åº¦</div><div style="color:${item.volRatio < 0.6 ? '#ff3e3e' : '#fff'}">${(item.volRatio*100).toFixed(0)}%</div></div>
                    </div>
                    <div class="ai-terminal" id="ai-${item.s}">> å•Ÿå‹• Llama-3-70B æ·±åº¦åˆ†æä¸­...</div>
                `;
                deck.appendChild(card);
                askAI(item);
            });
        }

        async function askAI(item) {
            try {
                const prompt = `ä½ æ˜¯åŠ å¯†è²¨å¹£ç‹™æ“Šæ‰‹ã€‚åˆ†æ ${item.s}ï¼šOIå¢é•· ${item.oiChg.toFixed(1)}%, é‡ç¸® ${(item.volRatio*100).toFixed(0)}%, è³‡è²» ${item.funding.toFixed(4)}%ã€‚åƒ¹æ ¼åºåˆ—: ${JSON.stringify(item.klines.map(k=>k[4]))}ã€‚
                è«‹ç²¾ç¢ºå›ç­”ï¼š1.è­˜åˆ¥å‹æ…‹ 2.è¡¨æ…‹æ–¹å‘ 3.é è¨ˆå¹¾åˆ†é˜å…§å™´ç™¼ 4.å‹ç‡ã€‚ç¹é«”ä¸­æ–‡ï¼Œå°ˆæ¥­å†·é…·é¢¨ï¼Œç›´æ¥çµ¦çµè«–ã€‚`;

                const resp = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                    method: "POST",
                    headers: { "Authorization": `Bearer ${GROQ_KEY}`, "Content-Type": "application/json" },
                    body: JSON.stringify({ model: "llama3-70b-8192", messages: [{role: "user", content: prompt}], temperature: 0.1 })
                });
                const d = await resp.json();
                document.getElementById(`ai-${item.s}`).innerText = ">> " + d.choices[0].message.content;
            } catch (e) { document.getElementById(`ai-${item.s}`).innerText = "AI å–šé†’å¤±æ•—"; }
        }

        engine();
    </script>
</body>
</html>
