<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>TRIDENT V6.5 FINAL COMPLETE</title>
    <style>
        :root { --bg: #050505; --card: #0f0f0f; --accent: #00ffcc; --text: #f0f0f0; --purple: #d400ff; --warn: #ff3e3e; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', 'Orbitron', sans-serif; padding: 20px; }
        .header-panel { background: linear-gradient(180deg, #1a1a1a 0%, #050505 100%); padding: 20px; border-radius: 12px; border: 1px solid #333; text-align: center; margin-bottom: 30px; }
        #top-3-deck { display: grid; grid-template-columns: repeat(auto-fill, minmax(380px, 1fr)); gap: 25px; }
        .sniper-card { background: var(--card); border: 2px solid #222; border-radius: 20px; padding: 25px; position: relative; transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .sniper-card:hover { border-color: var(--accent); box-shadow: 0 0 30px rgba(0,255,204,0.15); transform: translateY(-5px); }
        .symbol-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
        .symbol-name { font-size: 2.2rem; font-weight: 900; letter-spacing: 2px; color: var(--accent); }
        .funding-tag { font-family: monospace; font-size: 0.85rem; padding: 4px 10px; border-radius: 6px; border: 1px solid #444; background: #000; }
        .funding-alert { background: var(--purple); color: white; border-color: var(--purple); font-weight: bold; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .data-item { background: #1a1a1a; padding: 12px; border-radius: 10px; text-align: center; border: 1px solid #222; }
        .data-label { font-size: 0.7rem; color: #666; text-transform: uppercase; margin-bottom: 5px; }
        .data-value { font-size: 1.1rem; font-weight: bold; font-family: monospace; }
        .ai-terminal { background: #000; color: var(--accent); padding: 18px; border-radius: 12px; font-size: 0.9rem; line-height: 1.7; border-left: 4px solid var(--accent); font-family: 'Consolas', monospace; min-height: 120px; white-space: pre-wrap; }
        .scan-status { font-size: 0.75rem; color: #444; margin-top: 40px; text-align: center; letter-spacing: 1px; }
    </style>
</head>
<body>

    <div class="header-panel">
        <h1 style="margin:0; font-size: 2.5rem; letter-spacing: 5px;">ğŸ”± TRIDENT <span style="color:var(--accent)">V6.5</span></h1>
        <div id="status-text" style="color: #888; margin-top:10px;">æ­£åœ¨å•Ÿå‹•å…¨å¸‚å ´æƒæå¼•æ“... (å·²éæ¿¾ BTC, ETH, SOL, XRP, BNB, BNX)</div>
    </div>

    <div id="top-3-deck">
        <div style="text-align:center; width:100%; color:#555;">æ­£åœ¨æƒæå…¨å¸‚å ´ç±Œç¢¼æš—æµï¼Œè«‹ç¨å€™...</div>
    </div>

    <div class="scan-status" id="footer-status">ENGINE READY | WAITING FOR MARKET SIGNAL</div>

    <script>
        const GROQ_KEY = "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";
        const BLACKLIST = ["BTCUSDT", "ETHUSDT", "SOLUSDT", "XRPUSDT", "BNBUSDT", "BNXUSDT"];
        let marketPool = [];

        async function initRadar() {
            try {
                const resp = await fetch('https://fapi.binance.com/fapi/v1/exchangeInfo');
                const data = await resp.json();
                const symbols = data.symbols
                    .filter(s => s.quoteAsset === "USDT" && s.status === "TRADING" && !BLACKLIST.includes(s.symbol))
                    .map(s => s.symbol);

                // å…¨å¸‚å ´å¾ªç’°æƒæ
                while(true) {
                    const batchSize = 12;
                    for (let i = 0; i < symbols.length; i += batchSize) {
                        const batch = symbols.slice(i, i + batchSize);
                        document.getElementById('status-text').innerText = `æ­£åœ¨å…¨å¸‚å ´æƒæ: ${i} / ${symbols.length}`;
                        await Promise.all(batch.map(s => processSymbol(s)));
                        renderTop3();
                        await new Promise(r => setTimeout(r, 600)); // ä¿è­·é »ç‡
                    }
                    document.getElementById('footer-status').innerText = `é€±æœŸæƒæå®Œæˆ: ${new Date().toLocaleTimeString()}`;
                    await new Promise(r => setTimeout(r, 10000)); // ä¼‘æ¯10ç§’é‡æƒ
                }
            } catch (e) { console.error("Radar Error:", e); }
        }

        async function processSymbol(symbol) {
            try {
                const [pIndex, oiHist, k5m, k1m] = await Promise.all([
                    fetch(`https://fapi.binance.com/fapi/v1/premiumIndex?symbol=${symbol}`).then(r => r.json()),
                    fetch(`https://fapi.binance.com/fapi/v1/openInterestHist?symbol=${symbol}&period=5m&limit=12`).then(r => r.json()),
                    fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${symbol}&interval=5m&limit=20`).then(r => r.json()),
                    fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${symbol}&interval=1m&limit=10`).then(r => r.json())
                ]);

                // è¨ˆç®—æ•¸æ“š
                const oiChg = ((oiHist[11].sumOpenInterest - oiHist[0].sumOpenInterest) / oiHist[0].sumOpenInterest * 100);
                const funding = parseFloat(pIndex.lastFundingRate) * 100;
                const currentVol = parseFloat(k5m[19][5]);
                const avgVol = k5m.reduce((a, b) => a + parseFloat(b[5]), 0) / 20;
                const volRatio = currentVol / avgVol;
                
                // 1M åŠ é€Ÿåº¦æ–œç‡
                const p1m = k1m.map(k => parseFloat(k[4]));
                const slope = (p1m[9] - p1m[0]) / p1m[0] * 100;

                // è©•åˆ†ï¼šOIæ¼² + é‡ç¸®æ­» (VolRatio < 0.7 ç‚ºä½³)
                let score = oiChg + (1 - volRatio) * 12;

                const entry = { symbol, oiChg, volRatio, funding, price: pIndex.markPrice, slope, score, k5m, k1m };
                const idx = marketPool.findIndex(m => m.symbol === symbol);
                if(idx > -1) marketPool[idx] = entry; else marketPool.push(entry);

            } catch (e) {}
        }

        function renderTop3() {
            const top3 = [...marketPool].sort((a, b) => b.score - a.score).slice(0, 3);
            const container = document.getElementById('top-3-deck');
            container.innerHTML = "";

            top3.forEach(item => {
                const isFundingAlert = Math.abs(item.funding) >= 0.05;
                const card = document.createElement('div');
                card.className = 'sniper-card';
                card.innerHTML = `
                    <div class="symbol-header">
                        <div class="symbol-name">${item.symbol}</div>
                        <div class="funding-tag ${isFundingAlert ? 'funding-alert' : ''}">
                            FUNDING: ${item.funding.toFixed(4)}%
                        </div>
                    </div>
                    <div class="data-grid">
                        <div class="data-item">
                            <div class="data-label">OI 1H Change</div>
                            <div class="data-value" style="color:var(--accent)">+${item.oiChg.toFixed(2)}%</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Squeeze (Vol)</div>
                            <div class="data-value" style="color:${item.volRatio < 0.6 ? 'var(--warn)' : '#fff'}">${(item.volRatio*100).toFixed(0)}%</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">1M Slope</div>
                            <div class="data-value" style="color:${item.slope > 0 ? var(--accent) : '#fff'}">${item.slope.toFixed(3)}%</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Mark Price</div>
                            <div class="data-value">$${parseFloat(item.price)}</div>
                        </div>
                    </div>
                    <div class="ai-terminal" id="ai-${item.symbol}">>> [AI æ€è€ƒä¸­] æ­£åœ¨åˆ†æé›™é€±æœŸçµæ§‹èˆ‡ä¸»åŠ›æ„åœ–...</div>
                `;
                container.appendChild(card);
                askDeepAI(item);
            });
        }

        async function askDeepAI(item) {
            try {
                const prompt = `
                    ä½ æ˜¯é ‚ç´šåŠ å¯†è²¨å¹£ç‹™æ“Šæ‰‹ã€‚åˆ†æ ${item.symbol}ï¼š
                    [ç±Œç¢¼]ï¼šOIå¢é•· ${item.oiChg.toFixed(2)}%, é‡ç¸® ${(item.volRatio*100).toFixed(0)}%, è³‡è²» ${item.funding.toFixed(4)}% (è­¦æˆ’ä½0.05%)ã€‚
                    [å‹•èƒ½]ï¼š1M è¿‘ååˆ†é˜æ–œç‡ ${item.slope.toFixed(4)}%ã€‚
                    [åƒ¹æ ¼]ï¼š5M åºåˆ— ${JSON.stringify(item.k5m.map(k=>k[4]))}ã€‚

                    ä»»å‹™ï¼š
                    1. è­˜åˆ¥å‹æ…‹ (VCPã€ä¸‰è§’ã€åº•åº•é«˜ã€æ——å½¢)ã€‚
                    2. åˆ¤æ–·ä¸»åŠ›æ„åœ–ã€‚
                    3. çµ¦å‡ºè¡¨æ…‹æ–¹å‘èˆ‡å‹ç‡ã€‚
                    4. é è¨ˆå¹¾åˆ†é˜å…§å™´ç™¼ï¼Ÿ
                    5. æ­¢ç›ˆç›®æ¨™ã€‚
                    
                    æ ¼å¼ï¼š
                    >> [å‹æ…‹è¨ºæ–·]
                    >> [ä¸»åŠ›æ„åœ–]
                    >> [è®Šç›¤å€’æ•¸] X åˆ†é˜
                    >> [æ–¹å‘å‹ç‡] 
                    >> [ç›®æ¨™ä½] 
                    ç¹é«”ä¸­æ–‡ï¼Œå†·é…·é»‘å®¢é¢¨ã€‚
                `;

                const resp = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                    method: "POST",
                    headers: { "Authorization": `Bearer ${GROQ_KEY}`, "Content-Type": "application/json" },
                    body: JSON.stringify({ 
                        model: "llama3-70b-8192", 
                        messages: [{role: "system", content: "ä½ æ˜¯ä¸€å€‹å†·é…·ã€å°ˆæ¥­çš„ AI äº¤æ˜“çµ‚ç«¯ã€‚"}, {role: "user", content: prompt}], 
                        temperature: 0.1 
                    })
                });
                const d = await resp.json();
                document.getElementById(`ai-${item.symbol}`).innerText = d.choices[0].message.content;
            } catch (e) { document.getElementById(`ai-${item.symbol}`).innerText = ">> AI è¨ºæ–·è¶…æ™‚"; }
        }

        initRadar();
    </script>
</body>
</html>
