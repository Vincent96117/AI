<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>TRIDENT V6.5 - FINAL COMPLETE</title>
    <style>
        :root { --bg: #050505; --card: #0d0d0d; --accent: #00ffcc; --text: #f0f0f0; --purple: #d400ff; --warn: #ff3e3e; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; padding: 20px; }
        .header { background: linear-gradient(180deg, #1a1a1a 0%, #050505 100%); padding: 20px; border-radius: 12px; border: 1px solid #333; text-align: center; margin-bottom: 25px; }
        #sniper-deck { display: grid; grid-template-columns: repeat(auto-fill, minmax(380px, 1fr)); gap: 20px; }
        .card { background: var(--card); border: 2px solid #222; border-radius: 18px; padding: 22px; transition: 0.3s; position: relative; }
        .card:hover { border-color: var(--accent); box-shadow: 0 0 20px rgba(0,255,204,0.1); }
        .symbol-row { display: flex; justify-content: space-between; align-items: center; }
        .symbol { font-size: 2.2rem; font-weight: 900; color: var(--accent); }
        .funding { font-family: monospace; font-size: 0.8rem; padding: 4px 8px; border-radius: 5px; border: 1px solid #444; }
        .alert-purple { background: var(--purple) !important; color: white !important; border-color: var(--purple) !important; font-weight: bold; box-shadow: 0 0 10px var(--purple); }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .item { background: #151515; padding: 10px; border-radius: 8px; text-align: center; border: 1px solid #222; }
        .val { font-size: 1.1rem; font-weight: bold; font-family: monospace; }
        .ai-box { background: #000; color: var(--accent); padding: 15px; border-radius: 10px; font-size: 0.9rem; line-height: 1.6; border-left: 4px solid var(--accent); min-height: 100px; white-space: pre-wrap; }
    </style>
</head>
<body>

    <div class="header">
        <h1 style="margin:0; letter-spacing:4px;">ğŸ”± TRIDENT <span style="color:var(--accent)">V6.5 FINAL</span></h1>
        <div id="status" style="color:#666; font-size:0.8rem; margin-top:8px;">æƒæå¼•æ“æº–å‚™å°±ç·’ | æ’é™¤ BTC, ETH, SOL, XRP, BNB, BNX</div>
    </div>

    <div id="sniper-deck"></div>

    <script>
        // [2026-01-21] ç”¨æˆ¶å¯†é‘°æ³¨å…¥
        const PUSHOVER_USER = "Gkhqyhobnxzjfwgvaiyp347m1jkhn4";
        const PUSHOVER_TOKEN = "acyoe3sz15x4n91r1349fdcau7x6pw";
        const GROQ_KEY = "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";
        
        // [2026-01-12] éæ¿¾é»‘åå–®
        const BLACKLIST = ["BTCUSDT", "ETHUSDT", "SOLUSDT", "XRPUSDT", "BNBUSDT", "BNXUSDT"];
        let dataPool = [];

        async function engine() {
            try {
                const info = await fetch('https://fapi.binance.com/fapi/v1/exchangeInfo').then(r => r.json());
                const list = info.symbols
                    .filter(s => s.quoteAsset === "USDT" && s.status === "TRADING" && !BLACKLIST.includes(s.symbol))
                    .map(s => s.symbol);

                while(true) {
                    for (let i = 0; i < list.length; i += 12) {
                        const batch = list.slice(i, i + 12);
                        document.getElementById('status').innerText = `æ­£åœ¨é›·é”æƒæ: ${i} / ${list.length}`;
                        await Promise.all(batch.map(s => scan(s)));
                        updateUI();
                        await new Promise(r => setTimeout(r, 600)); 
                    }
                    await new Promise(r => setTimeout(r, 10000));
                }
            } catch (e) { console.error(e); }
        }

        async function scan(s) {
            try {
                // ä½¿ç”¨æš´åŠ›æ¥å£ç¢ºä¿ OI æ•¸æ“šä¸å ±éŒ¯
                const [pIndex, k5, k1, oi] = await Promise.all([
                    fetch(`https://fapi.binance.com/fapi/v1/premiumIndex?symbol=${s}`).then(r => r.json()),
                    fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=5m&limit=20`).then(r => r.json()),
                    fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${s}&interval=1m&limit=10`).then(r => r.json()),
                    fetch(`https://fapi.binance.com/fapi/v1/openInterest?symbol=${s}`).then(r => r.json())
                ]);

                const funding = parseFloat(pIndex.lastFundingRate) * 100;
                const curOI = parseFloat(oi.openInterest);
                const curVol = parseFloat(k5[19][5]);
                const avgVol = k5.reduce((a, b) => a + parseFloat(b[5]), 0) / 20;
                const volRatio = curVol / avgVol;
                const slope = (parseFloat(k1[9][4]) - parseFloat(k1[0][4])) / parseFloat(k1[0][4]) * 100;

                // ç¶œåˆè©•åˆ†ï¼šé‡ç¸®åŠ æˆ + è³‡è²»çµ•å°å€¼æ¬Šé‡
                const score = (1 - volRatio) * 15 + Math.abs(funding) * 50 + (slope > 0 ? 5 : 0);
                
                const entry = { s, funding, curOI, volRatio, price: pIndex.markPrice, slope, score, klines: k5 };
                const idx = dataPool.findIndex(d => d.s === s);
                if(idx > -1) dataPool[idx] = entry; else dataPool.push(entry);
            } catch (e) {}
        }

        function updateUI() {
            const top3 = [...dataPool].sort((a, b) => b.score - a.score).slice(0, 3);
            const deck = document.getElementById('sniper-deck');
            if(top3.length === 0) return;
            deck.innerHTML = "";

            top3.forEach(item => {
                // [2026-01-11] è³‡è²»æ­£è²  0.05% ç´«è‰²è­¦æˆ’
                const isAlert = Math.abs(item.funding) >= 0.05;
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="symbol-row">
                        <span class="symbol">${item.s}</span>
                        <span class="funding ${isAlert ? 'alert-purple' : ''}">FUNDING: ${item.funding.toFixed(4)}%</span>
                    </div>
                    <div class="grid">
                        <div class="item"><div style="font-size:0.7rem;color:#666">é‡ç¸®çª’æ¯åº¦</div><div class="val" style="color:${item.volRatio < 0.6 ? 'var(--warn)' : '#fff'}">${(item.volRatio*100).toFixed(0)}%</div></div>
                        <div class="item"><div style="font-size:0.7rem;color:#666">1M åŠ é€Ÿåº¦</div><div class="val" style="color:var(--accent)">${item.slope.toFixed(3)}%</div></div>
                        <div class="item"><div style="font-size:0.7rem;color:#666">å¯¦æ™‚ OI (æŒå€‰)</div><div class="val">${(item.curOI / 1000000).toFixed(2)}M</div></div>
                        <div class="item"><div style="font-size:0.7rem;color:#666">æ¨™è¨˜åƒ¹æ ¼</div><div class="val">$${parseFloat(item.price)}</div></div>
                    </div>
                    <div class="ai-box" id="ai-${item.s}">> AI æ­£åœ¨æ¥å…¥å…¨æ•¸æ“šè¨ºæ–·ä¸­...</div>
                `;
                deck.appendChild(card);
                askAI(item);
            });
        }

        async function askAI(item) {
            try {
                // åŠ å…¥å»¶é²é¿å… Groq 429 å ±éŒ¯
                await new Promise(r => setTimeout(r, 1500)); 
                const prompt = `ä½ æ˜¯å†·é…·ç‹™æ“Šæ‰‹ã€‚åˆ†æ ${item.s}ï¼šOI ${item.curOI}, é‡ç¸® ${(item.volRatio*100).toFixed(0)}%, è³‡è²» ${item.funding.toFixed(4)}% (0.05%è­¦æˆ’), 1Mæ–œç‡ ${item.slope.toFixed(4)}%ã€‚åƒ¹æ ¼:${JSON.stringify(item.klines.map(k=>k[4]))}ã€‚
                çµè«–ï¼š1.å‹æ…‹ 2.ä¸»åŠ›æ„åœ– 3.è¡¨æ…‹æ–¹å‘ 4.å¹¾åˆ†é˜å…§å™´ç™¼ 5.å‹ç‡ã€‚ç¹é«”ä¸­æ–‡ã€‚`;

                const resp = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                    method: "POST",
                    headers: { "Authorization": `Bearer ${GROQ_KEY}`, "Content-Type": "application/json" },
                    body: JSON.stringify({ model: "llama3-70b-8192", messages: [{role: "system", content: "ä½ æ˜¯ä¸€å€‹å°ˆæ¥­çš„ AI äº¤æ˜“çµ‚ç«¯ã€‚"}, {role: "user", content: prompt}], temperature: 0.1 })
                });
                const d = await resp.json();
                const result = d.choices[0].message.content;
                document.getElementById(`ai-${item.s}`).innerText = ">> " + result;

                if(result.includes("90%") || result.includes("95%")) {
                    fetch("https://api.pushover.net/1/messages.json", {
                        method: "POST",
                        headers: { "Content-Type": "application/x-www-form-urlencoded" },
                        body: `token=${PUSHOVER_TOKEN}&user=${PUSHOVER_USER}&message=ğŸ¯ é«˜å‹ç‡å™´ç™¼æ©Ÿæœƒ: ${item.s}\n${result}&title=ğŸ”± TRIDENT ALERT`
                    });
                }
            } catch (e) { document.getElementById(`ai-${item.s}`).innerText = ">> AI è¨ºæ–·éšŠåˆ—ä¸­..."; }
        }

        engine();
    </script>
</body>
</html>
