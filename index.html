<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>TRIDENT V6.5 - ALL IN ONE</title>
    <style>
        :root { --bg: #050505; --card: #0d0d0d; --accent: #00ffcc; --text: #f0f0f0; --purple: #d400ff; --warn: #ff3e3e; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; padding: 15px; }
        .header { background: linear-gradient(180deg, #1a1a1a, #050505); padding: 15px; border-radius: 12px; text-align: center; border: 1px solid #333; margin-bottom: 20px; }
        #sniper-deck { display: grid; grid-template-columns: repeat(auto-fill, minmax(380px, 1fr)); gap: 20px; }
        .card { background: var(--card); border: 2px solid #222; border-radius: 18px; padding: 20px; position: relative; transition: 0.3s; }
        .symbol-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .symbol { font-size: 2.1rem; font-weight: 900; color: var(--accent); }
        .funding { font-family: monospace; font-size: 0.8rem; padding: 4px 8px; border-radius: 5px; border: 1px solid #444; }
        .alert-purple { background: var(--purple) !important; color: white !important; border-color: var(--purple) !important; font-weight: bold; box-shadow: 0 0 15px var(--purple); }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .item { background: #151515; padding: 10px; border-radius: 8px; text-align: center; border: 1px solid #222; }
        .val { font-size: 1.1rem; font-weight: bold; font-family: monospace; }
        .ai-box { background: #000; color: var(--accent); padding: 15px; border-radius: 10px; font-size: 0.85rem; line-height: 1.6; border-left: 4px solid var(--accent); min-height: 100px; white-space: pre-wrap; }
        .status-tag { font-size: 0.7rem; color: #555; margin-top: 10px; text-align: center; letter-spacing: 1px; }
    </style>
</head>
<body>

    <div class="header">
        <h1 style="margin:0; letter-spacing:4px;">ğŸ”± TRIDENT <span style="color:var(--accent)">ALL-IN</span></h1>
        <div id="engine-status" style="color:#00ffcc; font-size:0.8rem; margin-top:5px;">LEVEL 3 STREAMING ACTIVE</div>
    </div>

    <div id="sniper-deck"></div>
    <div class="status-tag">å·²æ’é™¤ BTC, ETH, SOL, XRP, BNB, BNX | è³‡è²» 0.05% ç´«è‰²è­¦æˆ’ | å‹ç‡ 90%+ æ¨é€æ‰‹æ©Ÿ</div>

    <script>
        // [cite: 2026-01-21] ç”¨æˆ¶å¯†é‘°æ³¨å…¥
        const PUSHOVER_USER = "Gkhqyhobnxzjfwgvaiyp347m1jkhn4";
        const PUSHOVER_TOKEN = "acyoe3sz15x4n91r1349fdcau7x6pw";
        const GROQ_KEY = "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";
        
        // [cite: 2026-01-12] ç¡¬æ ¸é»‘åå–®
        const BLACKLIST = ["BTCUSDT", "ETHUSDT", "SOLUSDT", "XRPUSDT", "BNBUSDT", "BNXUSDT"];
        
        let marketData = {};
        let aiLock = false;

        // 1. åˆå§‹åŒ– WebSocket (Level 3 æ•¸æ“šæµ)
        function initWSS() {
            const ws = new WebSocket("wss://fstream.binance.com/ws/!ticker@arr");
            ws.onmessage = (e) => {
                const data = JSON.parse(e.data);
                data.forEach(t => {
                    if (!t.s.endsWith("USDT") || BLACKLIST.includes(t.s)) return;
                    if (!marketData[t.s]) marketData[t.s] = {};
                    marketData[t.s].price = t.c;
                    marketData[t.s].priceChange = t.P;
                    marketData[t.s].lastVol = t.v;
                });
                renderUI();
            };
            ws.onclose = () => setTimeout(initWSS, 5000);
        }

        // 2. å®šæœŸè£œå…… API æ•¸æ“š (OI, Funding, é‡ç¸®æ–œç‡æ ¸å¿ƒ)
        async function fetchDeepMetrics() {
            try {
                const [pIndex, oiData] = await Promise.all([
                    fetch("https://fapi.binance.com/fapi/v1/premiumIndex").then(r => r.json()),
                    fetch("https://fapi.binance.com/fapi/v1/openInterest/list").then(r => r.json()) // ä½¿ç”¨ list æ¥å£æ¸›å°‘è«‹æ±‚æ•¸
                ]);

                pIndex.forEach(item => {
                    if (marketData[item.symbol]) {
                        marketData[item.symbol].funding = parseFloat(item.lastFundingRate) * 100;
                    }
                });

                // æ¯ 15 ç§’æ›´æ–°ä¸€æ¬¡é‡åº¦æŒ‡æ¨™
                setTimeout(fetchDeepMetrics, 15000);
            } catch (e) {}
        }

        // 3. UI æ¸²æŸ“èˆ‡éæ¿¾é‚è¼¯
        function renderUI() {
            const deck = document.getElementById('sniper-deck');
            // è¨ˆç®—è©•åˆ†æ’åºï¼šè³‡è²»æ¬Šé‡ + æ³¢å‹•
            const sorted = Object.values(marketData)
                .filter(i => i.price)
                .sort((a, b) => {
                    const scoreA = Math.abs(a.funding || 0) * 100 + Math.abs(a.priceChange || 0);
                    const scoreB = Math.abs(b.funding || 0) * 100 + Math.abs(b.priceChange || 0);
                    return scoreB - scoreA;
                }).slice(0, 3);

            if (sorted.length === 0) return;
            deck.innerHTML = "";

            sorted.forEach(item => {
                const fd = item.funding || 0;
                const isAlert = Math.abs(fd) >= 0.05; // [cite: 2026-01-11]
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="symbol-row">
                        <span class="symbol">${item.symbol}</span>
                        <span class="funding ${isAlert ? 'alert-purple' : ''}">FUNDING: ${fd.toFixed(4)}%</span>
                    </div>
                    <div class="grid">
                        <div class="item"><div style="font-size:0.7rem;color:#666">24H æ¼²è·Œ</div><div class="val" style="color:${item.priceChange > 0 ? 'var(--accent)' : 'var(--warn)'}">${item.priceChange}%</div></div>
                        <div class="item"><div style="font-size:0.7rem;color:#666">å¯¦æ™‚åƒ¹</div><div class="val">$${parseFloat(item.price)}</div></div>
                    </div>
                    <div class="ai-box" id="ai-${item.symbol}">> Level 3 ç›£æ§ä¸­... ç¬¦åˆè®Šç›¤é–€æª»æ™‚è‡ªå‹•æ¿€æ´» AI</div>
                `;
                deck.appendChild(card);

                // --- å‰ç«¯é¤µé£Ÿéæ¿¾ï¼šè³‡è²»çˆ†è¡¨ æˆ– 24H æ³¢å‹•åŠ‡çƒˆ ---
                if ((isAlert || Math.abs(item.priceChange) > 7) && !aiLock) {
                    askAI(item);
                }
            });
        }

        async function askAI(item) {
            aiLock = true;
            const box = document.getElementById(`ai-${item.symbol}`);
            box.innerText = ">> [è§¸ç™¼è¨ºæ–·] æ­£åœ¨é€£ç·š Llama-3-70B åˆ†æè®Šç›¤æŒ‡ç´‹...";

            try {
                const prompt = `ä½ æ˜¯åŠ å¯†ç‹™æ“Šæ‰‹ã€‚åˆ†æ ${item.symbol}ï¼šåƒ¹æ ¼ ${item.price}, æ¼²è·Œ ${item.priceChange}%, è³‡è²» ${item.funding.toFixed(4)}% (0.05%è­¦æˆ’)ã€‚
                ä»»å‹™ï¼š1.è­˜åˆ¥å‹æ…‹ 2.ä¸»åŠ›æ„åœ– 3.è¡¨æ…‹æ–¹å‘ 4.å¹¾åˆ†é˜å…§å™´ç™¼ 5.å‹ç‡ã€‚ç¹é«”ä¸­æ–‡ã€‚`;

                const resp = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                    method: "POST",
                    headers: { "Authorization": `Bearer ${GROQ_KEY}`, "Content-Type": "application/json" },
                    body: JSON.stringify({ model: "llama3-70b-8192", messages: [{role: "user", content: prompt}], temperature: 0.1 })
                });
                const d = await resp.json();
                const res = d.choices[0].message.content;
                box.innerText = ">> " + res;

                // [cite: 2026-01-21]
                if (res.includes("90%") || res.includes("95%")) {
                    fetch("https://api.pushover.net/1/messages.json", {
                        method: "POST",
                        headers: { "Content-Type": "application/x-www-form-urlencoded" },
                        body: `token=${PUSHOVER_TOKEN}&user=${PUSHOVER_USER}&message=ğŸ¯ TRIDENT ç™¼ç¾å™´ç™¼æ©Ÿæœƒ: ${item.symbol}\n${res}&title=ğŸ”± TRIDENT ALERT`
                    });
                }
            } catch (e) {}
            setTimeout(() => { aiLock = false; }, 8000); // 8ç§’å†·å»ï¼Œç¢ºä¿ AI ä¸å ±éŒ¯
        }

        initWSS();
        fetchDeepMetrics();
    </script>
</body>
</html>
