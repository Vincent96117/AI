<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>üî± TRIDENT V15.0 FINAL</title>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; padding: 20px; }
        .card { border: 1px dotted #333; padding: 15px; margin-bottom: 10px; }
        .symbol { font-size: 1.5rem; color: #00ffcc; }
        .ai-box { background: #111; padding: 10px; color: #fff; border-left: 3px solid #0f0; margin-top: 5px; }
    </style>
</head>
<body>
    <h2>üî± TRIDENT V15.0 - Âº∑Âà∂Â∞çÊé•Ê®°Âºè</h2>
    <div id="deck"></div>

    <script>
        const GK = "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";
        const PT = "acyoe3sz15x4n91r1349fdcau7x6pw";
        const PU = "Gkhqyhobnxzjfwgvaiyp347m1jkhn4";
        const BLACKLIST = ["BTCUSDT", "ETHUSDT", "SOLUSDT", "XRPUSDT", "BNBUSDT", "BNXUSDT"];

        let market = {};
        let busy = false;

        async function start() {
            const r = await fetch("https://fapi.binance.com/fapi/v1/premiumIndex");
            const d = await r.json();
            d.forEach(i => {
                if (i.symbol.endsWith("USDT") && !BLACKLIST.includes(i.symbol)) {
                    market[i.symbol] = { s: i.symbol, fd: parseFloat(i.lastFundingRate)*100, p: i.markPrice, startP: i.markPrice };
                }
            });
            const ws = new WebSocket("wss://fstream.binance.com/ws/!ticker@arr");
            ws.onmessage = (e) => {
                JSON.parse(e.data).forEach(t => { if(market[t.s]) market[t.s].p = t.c; });
                draw();
            };
        }

        function draw() {
            const list = Object.values(market).filter(x => x.p).sort((a,b) => Math.abs(b.fd) - Math.abs(a.fd)).slice(0,3);
            const deck = document.getElementById("deck");
            deck.innerHTML = "";
            list.forEach(item => {
                const isAlert = Math.abs(item.fd) >= 0.05;
                const div = document.createElement("div");
                div.className = "card";
                div.innerHTML = `<span class="symbol">${item.s}</span> [FD: ${item.fd.toFixed(4)}%] <div id="ai-${item.s}" class="ai-box">Á≥ªÁµ±ÂæÖÂëΩ‰∏≠...</div>`;
                deck.appendChild(div);

                if (isAlert && !busy) callAI(item);
            });
        }

        async function callAI(item) {
            busy = true;
            document.getElementById(`ai-${item.s}`).innerText = ">> Ê≠£Âú®ÈÄ≤Ë°åÁ†¥Â£ÅÈÄ£Á∑ö...";
            
            try {
                // Êé°Áî®ÊúÄÂéüÂßãÁöÑ fetch ÈÖçÁΩÆÔºåÈò≤Ê≠¢Â§ñÊéõÂπ≤Êìæ
                const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                    method: "POST",
                    headers: { "Content-Type": "application/json", "Authorization": `Bearer ${GK}` },
                    body: JSON.stringify({
                        model: "llama3-70b-8192",
                        messages: [{role: "user", content: `Ê®ôÁöÑ:${item.s},ÂßãÂÉπ:${item.startP},ÁèæÂÉπ:${item.p},Ë≥áË≤ª:${item.fd}%„ÄÇÁµ¶Âá∫:ÊñπÂêë(Â§ö/Á©∫)„ÄÅË°®ÊÖãÊôÇÈñì(min)„ÄÅÂãùÁéá„ÄÇÁµêË´ñÁ¨¨‰∏ÄË°å„ÄÇ`}],
                        temperature: 0.1
                    })
                });

                const data = await response.json();
                if(data.error) throw new Error(data.error.message);
                
                const res = data.choices[0].message.content;
                document.getElementById(`ai-${item.s}`).innerText = ">> " + res;

                if (res.includes("9") || res.includes("È´ò")) {
                    fetch("https://api.pushover.net/1/messages.json", {
                        method: "POST",
                        headers: { "Content-Type": "application/x-www-form-urlencoded" },
                        body: `token=${PT}&user=${PU}&message=${encodeURIComponent(res)}&title=üî±TRIDENT:${item.s}`
                    });
                }
            } catch (err) {
                document.getElementById(`ai-${item.s}`).innerText = "‚ùå Êé•ÈÄöÂ§±ÊïóÔºö" + err.message;
            } finally {
                setTimeout(() => { busy = false; }, 10000);
            }
        }
        start();
    </script>
</body>
</html>
