<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ğŸ”± TRIDENT V18.0 - FINAL</title>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; padding: 20px; }
        .card { border: 2px solid #333; padding: 15px; margin-bottom: 15px; background: #050505; border-radius: 10px; }
        .symbol { font-size: 2rem; color: #00ffcc; font-weight: bold; }
        .ai-box { background: #111; padding: 15px; color: #fff; border-left: 5px solid #0f0; margin-top: 10px; font-size: 1.1rem; }
    </style>
</head>
<body>
    <h2>ğŸ”± TRIDENT V18.0 | GEMINI æœ€å¾Œå°æ¥æ¸¬è©¦</h2>
    <div id="deck"></div>

    <script>
        const GK = "AIzaSyCK5cMo5FL895WwRzggkFjPi0JRe5tVqXQ";
        const PU = "Gkhqyhobnxzjfwgvaiyp347m1jkhn4";
        const PT = "acyoe3sz15x4n91r1349fdcau7x6pw";
        const BLACKLIST = ["BTCUSDT", "ETHUSDT", "SOLUSDT", "XRPUSDT", "BNBUSDT", "BNXUSDT"];

        let market = {};
        let busy = false;

        async function init() {
            const r = await fetch("https://fapi.binance.com/fapi/v1/premiumIndex");
            const d = await r.json();
            d.forEach(i => {
                if (i.symbol.endsWith("USDT") && !BLACKLIST.includes(i.symbol)) {
                    market[i.symbol] = { s: i.symbol, fd: parseFloat(i.lastFundingRate)*100, p: i.markPrice };
                }
            });
            const ws = new WebSocket("wss://fstream.binance.com/ws/!ticker@arr");
            ws.onmessage = (e) => {
                JSON.parse(e.data).forEach(t => { if(market[t.s]) market[t.s].p = t.c; });
                draw();
            };
        }

        function draw() {
            const list = Object.values(market).filter(x => x.p).sort((a,b) => Math.abs(b.fd) - Math.abs(a.fd)).slice(0,3);
            const deck = document.getElementById("deck");
            deck.innerHTML = "";
            list.forEach(item => {
                const isH = Math.abs(item.fd) >= 0.05;
                const div = document.createElement("div");
                div.className = "card";
                div.innerHTML = `<span class="symbol">${item.s}</span> [FD: ${item.fd.toFixed(4)}%] <div id="ai-${item.s}" class="ai-box">ç­‰å¾…è§¸ç™¼...</div>`;
                deck.appendChild(div);
                if (isH && !busy) callAI(item);
            });
        }

        function callAI(item) {
            busy = true;
            const box = document.getElementById(`ai-${item.s}`);
            box.innerText = ">> æ­£åœ¨å¼·è¡Œçªç ´ Google é–˜é“...";

            // æš´åŠ›æ‹¼æ¥ç¶²å€ï¼Œé˜²æ­¢å¤–æ›æˆªæ–·
            const url = "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash" + ":" + "generateContent?key=" + GK;

            const xhr = new XMLHttpRequest();
            xhr.open("POST", url, true);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        const data = JSON.parse(xhr.responseText);
                        const res = data.candidates[0].content.parts[0].text;
                        box.innerText = ">> " + res;
                        // é€å‡º Pushover
                        fetch("https://api.pushover.net/1/messages.json", {
                            method: "POST",
                            headers: { "Content-Type": "application/x-www-form-urlencoded" },
                            body: `token=${PT}&user=${PU}&message=${encodeURIComponent(res)}&title=ğŸ”±ç‹™æ“Š:${item.s}`
                        });
                    } else {
                        box.innerText = "âŒ ç‹€æ…‹ç¢¼: " + xhr.status + " | éŒ¯èª¤å…§å®¹: " + xhr.responseText;
                    }
                    setTimeout(() => { busy = false; }, 10000);
                }
            };
            xhr.send(JSON.stringify({
                contents: [{ parts: [{ text: `æ¨™çš„:${item.s},è³‡è²»:${item.fd.toFixed(4)}%,åƒ¹æ ¼:${item.p}ã€‚è«‹çµ¦å‡º:æ–¹å‘ã€å‹ç‡ã€è¡¨æ…‹æ™‚é–“ã€‚ç¹é«”ä¸­æ–‡ã€‚` }] }]
            }));
        }
        init();
    </script>
</body>
</html>
